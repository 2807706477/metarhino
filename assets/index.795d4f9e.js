import{I as Icon,b as useUserStore,p as useModal,n as cloneDeep,i as useLoading,q as md5,s as axios,h as defHttp,_ as _export_sfc}from"./index.6eeff463.js";/* empty css               *//* empty css               *//* empty css              */import{d as defineComponent,bm as Button,r as ref,j as reactive,o as onMounted,c9 as dayjs,n as nextTick,aP as Message,aK as resolveComponent,F as openBlock,G as createElementBlock,aU as createVNode,aT as withCtx,H as createBaseVNode,aW as createTextVNode,aX as toDisplayString,J as normalizeStyle,c5 as TreeSelect,bx as Input,b6 as Space,be as Col,bd as Row,bE as Divider,c7 as Popconfirm,c8 as Table,bg as Option,bf as Select,ba as Popover}from"./arco.31164f47.js";import{f as useClipboard}from"./vue.85c125e1.js";import{G as GroupForm,c as columns,g as getTypeinfo}from"./GroupForm.e33aa3f9.js";import{g as getGroup,d as getList,e as del,f as getToken,h as getDBField}from"./devapi.612a3a83.js";import AddForm from"./AddForm.1022b7ac.js";import FieldModal from"./FieldModal.1b2227af.js";import{C as CodeEditor,M as MODE}from"./index.e1d1cf52.js";import"./chart.0656511d.js";/* empty css               */import"./common.a23b3726.js";import"./IconPicker.626a42e6.js";/* empty css               */import"./generatecode.9c63a080.js";import"./styles.e9716b1f.js";const _sfc_main=defineComponent({name:"devapi",components:{AddForm,Icon,GroupForm,CodeEditor,FieldModal,ButtonGroup:Button.Group},setup(){const userInfo=useUserStore(),selectedKeys=ref([]),modeValue=ref(MODE.JSON),{copy}=useClipboard(),[registerModal,{openModal}]=useModal(),[registerGroupModal,{openModal:openGroup}]=useModal(),[registerFieldModal,{openModal:openField}]=useModal(),searchData=ref({cid:0,title:"",url:""}),groupList=ref([]),requestData_base={id:0,title:"\u8BF7\u9009\u62E9\u8BF7\u6C42\u63A5\u53E3",url:"",method:"get",param:'{"title":"\u793A\u4F8B\u53C2\u6570"}',des:"",tablename:"",useFrom:"pc"},requestData=ref();requestData.value=cloneDeep(requestData_base);const requestAfter_base={step:"none",result:"",laoding:"waiting",status:200,message:"",code:0},requestAfter=ref();requestAfter.value=cloneDeep(requestAfter_base);const basePagination={current:1,pageSize:10},pagination=reactive({...basePagination,showTotal:!0,showPageSize:!0}),{loading,setLoading}=useLoading(!0),renderData=ref([]),initGetGroup=async()=>{const e=await getGroup(),t=[{id:0,name:"\u5168\u90E8\u5206\u7EC4",pid:0}];e?groupList.value=t.concat(e):groupList.value=t,nextTick(()=>{fetchData()})},onelineCardRef=ref(null),cardboxWidth=ref(1200);onMounted(()=>{initGetGroup(),cardboxWidth.value=onelineCardRef.value?onelineCardRef.value.$el.offsetWidth:1200,window.onresize=()=>{cardboxWidth.value=onelineCardRef.value?onelineCardRef.value.$el.offsetWidth:1100}});const fetchData=async()=>{setLoading(!0);try{const e=await getList({page:pagination.current,pageSize:pagination.pageSize,...searchData.value});renderData.value=e.items,pagination.current=e.page,pagination.total=e.total}catch{}finally{setLoading(!1)}},handlePaageChange=e=>{pagination.current=e,fetchData()},handlePaageSizeChange=e=>{pagination.pageSize=e,fetchData()},createRule=()=>{openModal(!0,{isUpdate:!1,record:null})},handleEdit=async e=>{openModal(!0,{isUpdate:!0,record:e})},handleData=async()=>{fetchData()},handleDel=async e=>{try{Message.loading({content:"\u5220\u9664\u4E2D",id:"upStatus"}),await del({ids:[e.id]})&&(fetchData(),Message.success({content:"\u5220\u9664\u6210\u529F",id:"upStatus"}))}catch{Message.clear("top")}},handleGroup=()=>{openGroup(!0,{isUpdate:!1,record:null})},typeInfo=ref({name:"",rooturl:"",verifyencrypt:"",isself:0}),handleRowClick=async e=>{handleSelect(e),selectedKeys.value=[e.id],typeInfo.value=await getTypeinfo({id:e.type_id})},handleSelect=e=>{requestAfter.value={step:"none",result:"",laoding:"waiting",status:200,message:"",code:0};let t=cloneDeep(e.url);requestData.value.url="",e.apicode_type==2&&(t=cloneDeep(`${t}?api_id=${e.api_id}`)),requestData.value={id:e.id,title:e.title,url:t,method:e.method,param:e.param,des:e.des,tablename:e.tablename,useFrom:e.useFrom,istoken:e.istoken}},copyText=async e=>{await copy(e),Message.success({content:"\u590D\u5236\u6210\u529F",id:"copysuccess"})},handleQuest=async()=>{if(!requestData.value.url){Message.warning("\u8BF7\u9009\u62E9\u6D4B\u8BD5\u63A5\u53E3\uFF01");return}if(requestAfter.value.laoding="processing",typeInfo.value.isself==1){const e=await reqhttp();e&&(requestAfter.value.result=e.data.data,requestAfter.value.status=e.status,requestAfter.value.message=e.data.message,requestAfter.value.code=e.data.code,e.data.code==0?requestAfter.value.laoding="success":requestAfter.value.laoding="error")}else if(typeInfo.value.isself==0){const e=await otherHttp();e&&(requestAfter.value.result=e.data.data,requestAfter.value.status=e.status,requestAfter.value.message=e.data.message,requestAfter.value.code=e.data.code,e.data.code==0?requestAfter.value.laoding="success":requestAfter.value.laoding="error")}else Message.warning({content:`\u63A5\u53E3\u7C7B\u578B\u65E0\u6CD5\u8BC6\u522B${requestData.value.useFrom}`,id:"wm"}),requestAfter.value.laoding="waiting"};async function otherHttp(){var e={};requestData.value.param&&(e=JSON.parse(requestData.value.param));const t=Date.parse(new Date().toString())/1e3;let o=typeInfo.value.rooturl,u="";if(requestData.value.istoken==1){const s=await getToken({baseURL:o,url:typeInfo.value.login_url,params:{user_id:typeInfo.value.user_id}});s.code==0&&(u=s.data)}const p=md5.exports(typeInfo.value.verifyencrypt+t),l=window.btoa(p+"#"+t);return requestData.value.method=="get"?axios.get(o+requestData.value.url,{params:e,headers:{apiverify:l,Authorization:u,Businessid:userInfo.$state?.business_id+""}}).catch(s=>{requestAfter.value.laoding="error",requestAfter.value.message=s.message,requestAfter.value.status=s.response.status,requestAfter.value.result=s.response.data.message}):requestData.value.method=="post"?axios.post(o+requestData.value.url,e,{headers:{apiverify:l,Authorization:u,Businessid:userInfo.$state?.business_id+""}}).catch(s=>{requestAfter.value.laoding="error",requestAfter.value.message=s.message,requestAfter.value.status=s.response.status,requestAfter.value.result=s.response.data.message}):requestData.value.method=="put"?axios.put(o+requestData.value.url,e,{headers:{apiverify:l,Authorization:u,Businessid:userInfo.$state?.business_id+""}}).catch(s=>{requestAfter.value.laoding="error",requestAfter.value.message=s.message,requestAfter.value.status=s.response.status,requestAfter.value.result=s.response.data.message}):requestData.value.method=="delete"?axios.delete(o+requestData.value.url,{data:e,headers:{apiverify:l,Authorization:u,Businessid:userInfo.$state?.business_id+""}}).catch(s=>{requestAfter.value.laoding="error",requestAfter.value.message=s.message,requestAfter.value.status=s.response.status,requestAfter.value.result=s.response.data.message}):!1}function reqhttp(){var params={};requestAfter.value.result="",requestData.value.param&&(params=eval("("+requestData.value.param+")"));var url_str=requestData.value.url.split("/");return url_str[0]=="business"?requestData.value.url=requestData.value.url.split("business")[1]:url_str.length>1&&url_str[1]=="business"&&(requestData.value.url=requestData.value.url.split("/business")[1]),requestData.value.method=="get"?defHttp.get({url:requestData.value.url,params},{isReturnNativeResponse:!0}).catch(e=>{requestAfter.value.laoding="error",requestAfter.value.message=e.message,requestAfter.value.status=e.response.status,requestAfter.value.result=e.response.data.message}):requestData.value.method=="post"?defHttp.post({url:requestData.value.url,params},{isReturnNativeResponse:!0}).catch(e=>{requestAfter.value.laoding="error",requestAfter.value.message=e.message,requestAfter.value.status=e.response.status,requestAfter.value.result=e.response.data.message}):requestData.value.method=="put"?defHttp.put({url:requestData.value.url,params},{isReturnNativeResponse:!0}).catch(e=>{requestAfter.value.laoding="error",requestAfter.value.message=e.message,requestAfter.value.status=e.response.status,requestAfter.value.result=e.response.data.message}):requestData.value.method=="delete"?defHttp.delete({url:requestData.value.url,params},{isReturnNativeResponse:!0}).catch(e=>{requestAfter.value.laoding="error",requestAfter.value.message=e.message,requestAfter.value.status=e.response.status,requestAfter.value.result=e.response.data.message}):!1}const showField=async e=>{if(!e){Message.error({content:"\u8BF7\u9009\u62E9\u67E5\u770B\u7684\u63A5\u53E3/\u63A5\u53E3\u4E0D\u5B58\u5728\u6570\u636E\u8868",id:"upStatus"});return}try{Message.loading({content:"\u83B7\u53D6\u5B57\u6BB5\u6570\u636E\u4E2D",id:"upStatus"});const t=await getDBField({tablename:e});t&&(openField(!0,{isUpdate:!0,record:t}),Message.success({content:"\u83B7\u53D6\u5B57\u6BB5\u6210\u529F",id:"upStatus"}))}catch{Message.clear("top")}};return{columns,dayjs,loading,pagination,renderData,handlePaageChange,handlePaageSizeChange,createRule,handleEdit,handleDel,registerModal,handleData,registerFieldModal,searchData,groupList,registerGroupModal,handleGroup,requestData,requestAfter,handleRowClick,copyText,handleQuest,modeValue,showField,userInfo,cardboxWidth,onelineCardRef,selectedKeys}}}),index_vue_vue_type_style_index_0_scoped_5151d6ce_lang="",_hoisted_1={class:"container"},_hoisted_2={class:"devapi"},_hoisted_3={class:"left"},_hoisted_4={class:"tablebox"},_hoisted_5={class:"tigbox"},_hoisted_6={class:"item"},_hoisted_7={class:"text"},_hoisted_8={class:"right"},_hoisted_9={class:"items-center"},_hoisted_10={class:"text-title"},_hoisted_11={class:"handlebox"},_hoisted_12={class:"url"},_hoisted_13={class:"parambox"},_hoisted_14={class:"doEvant"},_hoisted_15={class:"showapides"},_hoisted_16=["innerHTML"],_hoisted_17={class:"requtback"},_hoisted_18={class:"field_item"},_hoisted_19={class:"text"},_hoisted_20={class:"field_item"},_hoisted_21={class:"text"},_hoisted_22={class:"respdata"};function _sfc_render(e,t,o,u,p,l){const s=TreeSelect,c=Input,r=Button,d=Space,f=Col,v=Row,h=resolveComponent("CellStatus"),m=resolveComponent("Icon"),n=Divider,B=Popconfirm,C=Table,D=resolveComponent("icon-copy"),g=resolveComponent("CodeEditor"),i=Option,V=Select,A=Popover,q=resolveComponent("ButtonGroup"),_=resolveComponent("page-card"),F=resolveComponent("AddForm"),N=resolveComponent("GroupForm"),y=resolveComponent("FieldModal");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_,{breadcrumb:"",scrollPage:"",ref:"onelineCardRef"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createVNode(v,{style:{"margin-bottom":"10px"}},{default:withCtx(()=>[createVNode(f,{span:12},{default:withCtx(()=>[createVNode(d,null,{default:withCtx(()=>[createVNode(s,{placeholder:"\u9009\u62E9\u5206\u7EC4",data:e.groupList,style:{width:"120px"},fieldNames:{key:"id",title:"name",children:"children"},modelValue:e.searchData.cid,"onUpdate:modelValue":t[0]||(t[0]=a=>e.searchData.cid=a),onChange:e.handleData},null,8,["data","modelValue","onChange"]),createVNode(c,{style:{width:"180px"},modelValue:e.searchData.title,"onUpdate:modelValue":t[1]||(t[1]=a=>e.searchData.title=a),placeholder:"\u8F93\u5165\u63A5\u53E3\u540D\u79F0",onPressEnter:e.handleData,"allow-clear":""},null,8,["modelValue","onPressEnter"]),createVNode(c,{style:{width:"180px"},modelValue:e.searchData.url,"onUpdate:modelValue":t[2]||(t[2]=a=>e.searchData.url=a),placeholder:"\u8F93\u5165\u8BF7\u6C42\u5730\u5740",onPressEnter:e.handleData,"allow-clear":""},null,8,["modelValue","onPressEnter"]),createVNode(r,{type:"primary",onClick:e.handleData},{default:withCtx(()=>[...t[8]||(t[8]=[createTextVNode("\u67E5\u627E",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1}),createVNode(f,{span:12,style:{"text-align":"right"}},{default:withCtx(()=>[createVNode(d,null,{default:withCtx(()=>[createVNode(r,{type:"primary",onClick:e.createRule},{default:withCtx(()=>[createTextVNode(toDisplayString(e.$t("developer.apidoc.createapi")),1)]),_:1},8,["onClick"]),createVNode(r,{type:"primary",onClick:e.handleGroup},{default:withCtx(()=>[createTextVNode(toDisplayString(e.$t("developer.apidoc.mgroun")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),createBaseVNode("div",_hoisted_4,[createVNode(C,{"row-key":"id",loading:e.loading,pagination:e.pagination,columns:e.columns,data:e.renderData,bordered:{wrapper:!0,cell:!0},size:"large",scroll:{x:"100%"},"default-expand-all-rows":!0,ref:"artable","selected-keys":e.selectedKeys,onPageChange:e.handlePaageChange,onPageSizeChange:e.handlePaageSizeChange,onRowClick:e.handleRowClick},{createtime:withCtx(({record:a})=>[createTextVNode(toDisplayString(e.dayjs(a.createtime).format("YYYY-MM-DD")),1)]),status:withCtx(({record:a})=>[createVNode(h,{status:a.status},null,8,["status"])]),istoken:withCtx(({record:a})=>[createBaseVNode("span",{style:normalizeStyle({color:a.istoken==0?"gray":"orangered"})},toDisplayString(a.istoken==0?"\u4E0D\u9700":"\u9700\u8981"),5)]),operations:withCtx(({record:a})=>[createVNode(m,{icon:"svgfont-bianji1",class:"iconbtn",onClick:w=>e.handleEdit(a),size:18,color:"#0960bd"},null,8,["onClick"]),createVNode(n,{direction:"vertical"}),createVNode(B,{content:"\u60A8\u786E\u5B9A\u8981\u5220\u9664\u5417?",onOk:w=>e.handleDel(a)},{default:withCtx(()=>[createVNode(m,{icon:"svgfont-icon7",class:"iconbtn",size:18,color:"#ed6f6f"})]),_:1},8,["onOk"])]),_:1},8,["loading","pagination","columns","data","selected-keys","onPageChange","onPageSizeChange","onRowClick"])]),createBaseVNode("div",_hoisted_5,[t[10]||(t[10]=createBaseVNode("div",{class:"title"},"\u8BF7\u6C42\u8BF4\u660E\uFF1A",-1)),createBaseVNode("div",_hoisted_6,[t[9]||(t[9]=createBaseVNode("div",{class:"label"},"1.\u5C0F\u7A0B\u5E8F\u3001app\u8BF7\u6C42\u5934\u6DFB\u52A0\u201CBusinessid\u201D\u503C\uFF1A",-1)),createBaseVNode("div",_hoisted_7,toDisplayString(e.userInfo.$state.business_id),1)]),t[11]||(t[11]=createBaseVNode("div",{class:"item"},[createBaseVNode("div",{class:"label"},"2.\u8BF7\u6C42\u9700\u8981Token\u65F6\uFF0C\u8BF7\u5728\u8BF7\u6C42\u5934\u52A0\u201CAuthorization\u201D\u503C\u662FToken"),createBaseVNode("div",{class:"text"})],-1)),t[12]||(t[12]=createBaseVNode("div",{class:"item"},[createBaseVNode("div",{class:"label"},[createTextVNode("3.\u63A5\u53E3\u8BF7\u6C42\u9A8C\u8BC1\uFF0C\u8BF7\u6C42\u5934\u6DFB\u52A0 apiverify=base64(md5(\u65F6\u95F4\u6233+\u63A5\u53E3\u9A8C\u8BC1\u5B57\u7B26\u4E32)),\u63A5\u53E3\u9A8C\u8BC1\u5B57\u7B26\u4E32\u5728"),createBaseVNode("span",{style:{color:"#165dff"}},"\u7BA1\u7406\u5206\u7EC4->\u63A5\u53E3\u914D\u7F6E"),createTextVNode("\u4E2D")]),createBaseVNode("div",{class:"text"})],-1)),t[13]||(t[13]=createBaseVNode("div",{class:"item"},[createBaseVNode("div",{class:"label"},[createTextVNode("4.\u63A5\u53E3\u81EA\u52A8\u751F\u6210\u65F6\uFF0C\u5982\u679C\u65B0\u589E\u6A21\u5757\uFF08\u4F8B\u5982admin\uFF09\u8BF7\u624B\u52A8\u628A\u6A21\u5757\u8DEF\u7531\u6DFB\u52A0\u5230route\\router.go\u4E0B,\u540C\u6837\u4E5F\u9700\u624B\u52A8\u5220\u9664\uFF0C\u8FD9\u79CD\u60C5\u51B5\u6BD4\u8F83\u5C11\u7CFB\u7EDF\u4E0D\u518D\u81EA\u52A8\u6DFB\u52A0\u3002"),createBaseVNode("a",{href:"https://doc.goflys.cn/docview?id=25&fid=274",target:"_blank",style:{color:"#165dff"}},"\u53BB\u5F00\u53D1\u6587\u6863\u67E5\u770B\u66F4\u591A")]),createBaseVNode("div",{class:"text"})],-1))])]),createBaseVNode("div",_hoisted_8,[createBaseVNode("div",_hoisted_9,[t[14]||(t[14]=createBaseVNode("span",{class:"text-label"},"\u63A5\u53E3\u540D\u79F0: ",-1)),createBaseVNode("span",_hoisted_10,toDisplayString(e.requestData.title),1)]),createVNode(n,{dashed:"",style:{margin:"10px 0px"}}),createBaseVNode("div",_hoisted_11,[createBaseVNode("div",_hoisted_12,[t[15]||(t[15]=createTextVNode("\u8BF7\u6C42\u5730\u5740\uFF1A",-1)),createBaseVNode("a",{onClick:t[3]||(t[3]=a=>e.copyText(e.requestData.url))},[createTextVNode(toDisplayString(e.requestData.url)+" ",1),createVNode(D)])])]),createBaseVNode("div",_hoisted_13,[createVNode(g,{value:e.requestData.param,"onUpdate:value":t[4]||(t[4]=a=>e.requestData.param=a),mode:e.modeValue},null,8,["value","mode"])]),createBaseVNode("div",_hoisted_14,[createVNode(d,null,{default:withCtx(()=>[createVNode(V,{style:{width:"95px"},modelValue:e.requestData.method,"onUpdate:modelValue":t[5]||(t[5]=a=>e.requestData.method=a),placeholder:"\u9009\u62E9\u8BF7\u6C42\u65B9\u5F0F"},{default:withCtx(()=>[createVNode(i,{value:"get"},{default:withCtx(()=>[...t[16]||(t[16]=[createTextVNode("get",-1)])]),_:1}),createVNode(i,{value:"post"},{default:withCtx(()=>[...t[17]||(t[17]=[createTextVNode("post",-1)])]),_:1}),createVNode(i,{value:"put"},{default:withCtx(()=>[...t[18]||(t[18]=[createTextVNode("put",-1)])]),_:1}),createVNode(i,{value:"delete"},{default:withCtx(()=>[...t[19]||(t[19]=[createTextVNode("delete",-1)])]),_:1})]),_:1},8,["modelValue"]),createVNode(r,{type:"primary",onClick:e.handleQuest},{default:withCtx(()=>[...t[20]||(t[20]=[createTextVNode("\u7ACB\u5373\u8BF7\u6C42",-1)])]),_:1},8,["onClick"]),createVNode(q,{status:"warning"},{default:withCtx(()=>[createVNode(A,{position:"tr",title:"\u63A5\u53E3\u8BF4\u660E",trigger:"click"},{title:withCtx(()=>[t[22]||(t[22]=createBaseVNode("div",{class:"popovertitle"}," \u63A5\u53E3\u8BF4\u660E ",-1)),createVNode(n,{dashed:"",style:{margin:"5px 0px"}})]),content:withCtx(()=>[createBaseVNode("div",_hoisted_15,[createBaseVNode("div",{class:"text",innerHTML:e.requestData.des},null,8,_hoisted_16)])]),default:withCtx(()=>[createVNode(r,null,{default:withCtx(()=>[...t[21]||(t[21]=[createTextVNode("\u67E5\u770B\u8BF4\u660E",-1)])]),_:1})]),_:1}),createVNode(r,{onClick:t[6]||(t[6]=a=>e.showField(e.requestData.tablename))},{default:withCtx(()=>[...t[23]||(t[23]=[createTextVNode("\u67E5\u770B\u5B57\u6BB5",-1)])]),_:1})]),_:1})]),_:1})]),createBaseVNode("div",_hoisted_17,[t[26]||(t[26]=createBaseVNode("div",{class:"text-label"},"\u8BF7\u6C42\u7ED3\u679C ",-1)),createVNode(n,{dashed:"",style:{margin:"10px 0px"}}),createBaseVNode("div",_hoisted_18,[t[24]||(t[24]=createBaseVNode("div",{class:"label"},"\u8BF7\u6C42\u72B6\u6001\uFF1A",-1)),createBaseVNode("div",_hoisted_19,toDisplayString(e.requestAfter.laoding),1)]),createBaseVNode("div",_hoisted_20,[t[25]||(t[25]=createBaseVNode("div",{class:"label"},"\u8BF7\u6C42\u7ED3\u679C\uFF1A",-1)),createBaseVNode("div",_hoisted_21,[createBaseVNode("span",{class:"mr-4",style:normalizeStyle({color:e.requestAfter.status==200?"#108ee9":"#f50"})},toDisplayString(e.requestAfter.status),5),createBaseVNode("span",{class:"mr-4",style:normalizeStyle({color:e.requestAfter.status==200?"#108ee9":"#f50"})},"\u63D0\u793A("+toDisplayString(e.requestAfter.code)+")\uFF1A"+toDisplayString(e.requestAfter.message),5)])]),createBaseVNode("div",_hoisted_22,[createVNode(g,{value:e.requestAfter.result,"onUpdate:value":t[7]||(t[7]=a=>e.requestAfter.result=a),readonly:"",mode:e.modeValue},null,8,["value","mode"])])])])])]),_:1},512),createVNode(F,{onRegister:e.registerModal,onSuccess:e.handleData},null,8,["onRegister","onSuccess"]),createVNode(N,{onRegister:e.registerGroupModal,onSuccess:e.handleData},null,8,["onRegister","onSuccess"]),createVNode(y,{onRegister:e.registerFieldModal},null,8,["onRegister"])])}const index=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-5151d6ce"]]);export{index as default};
