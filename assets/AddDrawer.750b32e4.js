import{F as H,h as g,I as Y,n as h,i as j,_ as J}from"./index.6eeff463.js";/* empty css               *//* empty css              *//* empty css               */import{d as K,r,c as q,u as _,n as N,aP as U,F as k,aH as I,aT as n,aW as C,aX as y,H as A,aU as u,aI as z,G as O,aY as P,aV as W,bx as X,bK as x,c5 as Q,c6 as Z,br as ee,bM as ae,bh as te,cd as oe,cf as se,bN as le,bG as ne}from"./arco.31164f47.js";function Ae(e){return e=H(e),g.get({url:"/system/role/getList",params:e},{errorMessageMode:"message"})}function ue(e){return g.get({url:"/system/role/getParent",params:e},{errorMessageMode:"message"})}function re(e){return g.get({url:"/system/role/getMenuList",params:e},{errorMessageMode:"message"})}function de(e){return g.post({url:"/system/role/save",params:e},{errorMessageMode:"message"})}function Fe(e){return g.post({url:"/system/role/upStatus",params:e},{errorMessageMode:"message"})}function Me(e){return g.delete({url:"/system/role/del",params:e},{errorMessageMode:"message"})}const ie=K({name:"AddDrawer",components:{Icon:Y},emits:["success"],setup(e,{emit:s}){const b=r(!1),f=r(!1),v=r([]),S=r([]),E=r([]),d=r(),V={id:0,pid:0,name:"",remark:"",menu:[],btns:S.value,rules:[],weigh:1,data_access:0},F=h(V),a=r(F),m=r(!1),M=r(!1),D=r(!1),i=r(),w=r([]),B=async o=>{a.value=h(V),f.value=!!o?.isUpdate,b.value=!0,d.value?.resetFields();const l=await ue({id:o.record?o.record.id:0});if(l&&l.length>0){if(v.value=l,!_(f))a.value.pid=l[0].id;else if(o.record.pid==0){const p=[{id:0,name:"\u4E00\u7EA7\u89D2\u8272",pid:0,locale:""}];v.value=p.concat(l)}}else v.value=[];if(_(f)){a.value=h(o.record);const p=h(o.record.menu),L=h(o.record.btns);L?a.value.btns=JSON.parse(L):a.value.btns=[],o.record.rules=="*"?m.value=!0:m.value=!1,p=="*"?(a.value.menu=[],N(()=>{setTimeout(()=>{i.value&&i.value.checkAll(!0)},800)})):a.value.menu&&p!="*"&&(a.value.menu=JSON.parse(p))}else a.value.menu=[];const T=_(f)?o.record.pid:0;c(T)},t=()=>{c(a.value.pid)},c=async o=>{const l=await re({pid:o});w.value=l.list,E.value=l.btn_rule_ids,N(()=>{D.value=!0,i.value.expandAll(D.value)})},$=q(()=>_(f)?"\u7F16\u8F91\u89D2\u8272\u83DC\u5355":"\u65B0\u589E\u89D2\u8272\u83DC\u5355"),{loading:G,setLoading:R}=j();return{showDrawer:b,handleCancel:()=>{b.value=!1},openDrawer:B,getTitle:$,handleSubmit:async()=>{try{await d.value?.validate()||(R(!0),U.loading({content:"\u63D0\u4EA4\u6570\u636E\u4E2D",id:"save",duration:0}),await de(_(a)),U.success({content:"\u6570\u636E\u63D0\u4EA4\u6210\u529F",id:"save",duration:2e3}),s("success"),b.value=!1,R(!1))}catch{R(!1),U.loading({content:"\u63D0\u4EA4\u6570\u636E\u4E2D",id:"save",duration:1})}},formRef:d,handleUpRolsdata:t,loading:G,formData:a,parntList:v,OYoptions:[{label:"\u81EA\u5DF1",value:0},{label:"\u81EA\u5DF1\u53CA\u5B50\u6743\u9650",value:1},{label:"\u5168\u90E8",value:2}],menutreeData:w,onCheck:(o,l)=>{a.value.menu=o,l.node&&(l.checked&&l.node.btnids?a.value.btns=a.value.btns.concat(l.node.btnids):l.node.btnids&&l.node.btnids.map(T=>{a.value.btns.splice(a.value.btns.findIndex(p=>p.id==T),1)}),a.value.btns&&a.value.btns.length>1&&(a.value.btns=Array.from(new Set(a.value.btns))))},toggleChecked:o=>{i.value.checkAll(o),o?a.value.btns=E.value:a.value.btns=[]},toggleExpanded:o=>{i.value.expandAll(o)},ruleTreeRef:i,onExpanded:D,IsChecked:M,isRules:m}}});const ce={class:"drawer-box"},me={class:"rule_data"},pe={class:"haeder"},fe={class:"treebox"};function ge(e,s,b,f,v,S){const E=X,d=x,V=Q,F=Z,a=ee,m=ae,M=te,D=oe,i=se,w=le,B=ne;return k(),I(B,{width:450,visible:e.showDrawer,onOk:e.handleSubmit,onCancel:e.handleCancel,unmountOnClose:""},{title:n(()=>[C(y(e.getTitle),1)]),default:n(()=>[A("div",ce,[u(w,{ref:"formRef",model:e.formData,"auto-label-width":""},{default:n(()=>[u(d,{field:"name",label:"\u89D2\u8272\u540D\u79F0","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0"}],style:{"margin-bottom":"15px"}},{default:n(()=>[u(E,{modelValue:e.formData.name,"onUpdate:modelValue":s[0]||(s[0]=t=>e.formData.name=t),placeholder:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0","allow-clear":""},null,8,["modelValue"])]),_:1}),u(d,{label:"\u4E0A\u7EA7\u83DC\u5355",field:"pid",style:{"margin-bottom":"15px"}},{default:n(()=>[u(V,{placeholder:"\u9009\u62E9\u4E0A\u7EA7\u83DC\u5355",data:e.parntList,fieldNames:{key:"id",title:"name",children:"children"},modelValue:e.formData.pid,"onUpdate:modelValue":s[1]||(s[1]=t=>e.formData.pid=t),onChange:e.handleUpRolsdata},null,8,["data","modelValue","onChange"])]),_:1}),u(d,{field:"remark",label:"\u5907\u6CE8","validate-trigger":"input",style:{"margin-bottom":"15px"}},{default:n(()=>[u(F,{modelValue:e.formData.remark,"onUpdate:modelValue":s[2]||(s[2]=t=>e.formData.remark=t),placeholder:"\u8BF7\u586B\u5199\u5907\u6CE8","allow-clear":""},null,8,["modelValue"])]),_:1}),u(d,{field:"data_access",label:"\u6570\u636E\u6743\u9650",style:{"margin-bottom":"5px"}},{default:n(()=>[u(a,{modelValue:e.formData.data_access,"onUpdate:modelValue":s[3]||(s[3]=t=>e.formData.data_access=t),options:e.OYoptions},null,8,["modelValue","options"])]),_:1}),u(d,{field:"menu",label:"\u83DC\u5355\u5206\u914D",style:{"margin-bottom":"5px"}},{default:n(()=>[A("div",me,[A("div",pe,[e.isRules?z("",!0):(k(),I(m,{key:0,modelValue:e.IsChecked,"onUpdate:modelValue":s[4]||(s[4]=t=>e.IsChecked=t),onChange:e.toggleChecked,style:{"margin-right":"15px"}},{default:n(()=>[C(y(e.IsChecked?"\u53D6\u6D88":"\u5168\u9009"),1)]),_:1},8,["modelValue","onChange"])),u(m,{modelValue:e.onExpanded,"onUpdate:modelValue":s[5]||(s[5]=t=>e.onExpanded=t),onChange:e.toggleExpanded},{default:n(()=>[C(y(e.onExpanded?"\u6536\u8D77":"\u5C55\u5F00"),1)]),_:1},8,["modelValue","onChange"])]),A("div",fe,[u(i,{modelValue:e.formData.btns,"onUpdate:modelValue":s[7]||(s[7]=t=>e.formData.btns=t)},{default:n(()=>[u(D,{"show-line":!0,checkable:!e.isRules,"checked-keys":e.formData.menu,"onUpdate:checkedKeys":s[6]||(s[6]=t=>e.formData.menu=t),fieldNames:{key:"id",title:"title",children:"children"},ref:"ruleTreeRef",onCheck:e.onCheck,data:e.menutreeData},{title:n(t=>[t.checkable?(k(),O(P,{key:0},[C(y(t.title),1)],64)):(k(!0),O(P,{key:1},W(t.btn_rules,c=>(k(),I(M,{content:c.des?c.des:c.title,position:"top",mini:""},{default:n(()=>[u(m,{value:c.id},{default:n(()=>[C(y(c.title),1)]),_:2},1032,["value"])]),_:2},1032,["content"]))),256))]),_:1},8,["checkable","checked-keys","onCheck","data"])]),_:1},8,["modelValue"])])])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible","onOk","onCancel"])}const be=J(ie,[["render",ge],["__scopeId","data-v-1c5ab41c"]]),Be=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{be as A,Be as a,Me as d,Ae as g,Fe as u};
