import{h as N,B as Y,I as j,m as J,n as U,i as Q,_ as Z}from"./index.55d7b75d.js";/* empty css               *//* empty css               *//* empty css              */import{d as x,r as D,u as M,c as ee,aP as f,aK as q,F as n,aH as g,aT as u,aU as l,G as C,aY as T,aV as G,aW as d,aX as h,H as F,aI as E,I as ae,b3 as ue,bx as le,bK as te,be as oe,bg as se,bf as de,c5 as ne,bq as ie,br as re,c6 as me,bm as pe,bd as fe,bN as ge}from"./arco.c01548ff.js";import{g as ve,a as Ee,s as De}from"./devapi.291fd029.js";import{g as Fe}from"./common.18828855.js";import{g as K}from"./generatecode.e93cb7ef.js";import{I as ye}from"./IconPicker.396147fe.js";import"./chart.a60a60a0.js";import"./vue.c31cb100.js";function be(e){return N.post({url:"/apidoc/apicode/installcode",params:e},{errorMessageMode:"message"})}function Be(e){return N.post({url:"/apidoc/apicode/uninstallcode",params:e},{errorMessageMode:"message"})}function ce(e){return N.post({url:"/apidoc/apicode/removeFile",params:e},{errorMessageMode:"message"})}const _e=x({name:"AddBook",components:{BasicModal:Y,IconPicker:ye,Icon:j},emits:["success"],setup(e,{emit:a}){const k=D(!1),y=D([]),A=D([]),S=D([]),_=D([]),i=D(),r={id:0,type:"biz",cid:0,status:0,istoken:0,title:"",des:"",url:"",param:"",method:"get",tablename:"",apicode_type:0,is_install:0,fields:[],getdata_type:"list"},t=D(r),v=D(""),[R,{setModalProps:m,closeModal:b}]=J(async s=>{i.value?.resetFields(),m({confirmLoading:!1});const p=await ve(),B=[{id:0,name:"\u672A\u9009\u5206\u7EC4",pid:0}];p?A.value=B.concat(p):A.value=B,S.value=await Fe({}),_.value=await Ee({}),k.value=!!s?.isUpdate,M(k)?(t.value=U(s.record),t.value.fields&&(t.value.fields=t.value.fields.split(",")),t.value.method=="get"&&setTimeout(async()=>{y.value=await K({tablename:s.record.tablename})},1e3),v.value=s.record.url):(t.value=U(r),y.value=[])}),w=ee(()=>M(k)?"\u7F16\u8F91\u7BA1\u7406\u63A5\u53E3":"\u65B0\u589E\u7BA1\u7406\u63A5\u53E3"),{loading:V,setLoading:c}=Q(),I=async()=>{try{if(!await i.value?.validate()){c(!0),f.loading({content:"\u4FDD\u5B58\u4E2D",id:"upStatus"});let p=U(M(t)),B="";p.fields&&p.fields.forEach(z=>{z&&(B==""?B+=z:B+=","+z)}),p.fields=B,await De(M(p)),f.success({content:"\u4FDD\u5B58\u6210\u529F",id:"upStatus"}),b(),a("success"),c(!1)}}catch{c(!1),f.clear("top")}},L=async()=>{try{f.loading({content:"\u751F\u6210\u63A5\u53E3\u4EE3\u7801\u4E2D",id:"upStatus",duration:0}),await be({id:t.value.id})&&(t.value.is_install=1,a("success"),f.success({content:"\u751F\u6210\u63A5\u53E3\u4EE3\u7801\u6210\u529F",id:"upStatus",duration:1e3}))}catch{f.clear("top")}},$=async()=>{try{f.loading({content:"\u5378\u8F7D\u4E2D",id:"upStatus",duration:0}),await Be({id:t.value.id})&&(a("success"),t.value.is_install=2,f.success({content:"\u5378\u8F7D\u6210\u529F",id:"upStatus",duration:1e3}))}catch{f.clear("top")}},o=async()=>{try{f.loading({content:"\u5220\u9664\u6587\u4EF6\u4E2D",id:"upStatus",duration:0}),await ce({id:t.value.id})&&(t.value.is_install=0,f.success({content:"\u5220\u9664\u6587\u4EF6\u529F",id:"upStatus",duration:1e3}))}catch{f.clear("top")}},W=()=>{t.value.apicode_type!=0&&H()},X=s=>{if(s){const p=s.split(":");p.length>=1&&(t.value.url=p[1],p[0]=="GET"?t.value.method="get":p[0]=="POST"?t.value.method="post":p[0]=="PUT"?t.value.method="put":p[0]=="DELETE"&&(t.value.method="delete"))}},H=()=>{t.value.apicode_type==2&&v.value==""&&(v.value=U(t.value.url)),O()},O=()=>{if(t.value.apicode_type==2)t.value.url="./common/api/"+P();else if(t.value.apicode_type==1){if(t.value.tablename){const s=t.value.tablename.split("_");s.length>=3?t.value.url=`/${s[1]}/${s[2]}/`+P():s.length==2&&(t.value.url=`/${s[0]}/${s[1]}/`+P())}}else t.value.url=v.value?v.value:t.value.url},P=()=>{let s="";return t.value.method=="get"?t.value.getdata_type=="list"?s="getList":t.value.getdata_type=="data"&&(s="getData"):t.value.method=="post"?s="add":t.value.method=="put"?s="put":t.value.method=="delete"&&(s="del"),s};return{registerModal:R,getTitle:w,handleSubmit:I,formRef:i,loading:V,formData:t,groupList:A,hanldeUrl:X,handleInstall:L,handleUninstall:$,fieldList:y,handelApicodeType:H,handelGetdataType:O,handelSelectFields:async s=>{if(s&&(!y.value||y.value.length==0)){if(!t.value.tablename){f.error({content:"\u8BF7\u4F60\u5148\u586B\u5199\u6570\u636E\u5E93\u540D\u79F0\u518D\u9009\u62E9\u6570\u636E\u5B57\u6BB5",id:"upStatus"});return}y.value=await K({tablename:t.value.tablename})}},handelMethodType:W,handleRemoveFile:o,tablelist:S,tablefallback:s=>(console.log(s),{value:s,label:`++${s}++`}),routerlist:_}}});const Ve={class:"flexbox"},Ce={class:"left"},he={class:"right"},ke={key:2,class:"notig"},Ae={class:"tigmsg"},we={class:"tigmsg"};function Ue(e,a,k,y,A,S){const _=le,i=te,r=oe,t=se,v=de,R=ne,m=ie,b=re,w=me,V=pe,c=q("icon-exclamation-circle"),I=fe,L=ge,$=q("BasicModal");return n(),g($,ue(e.$attrs,{onRegister:e.registerModal,loading:e.loading,helpMessage:"\u7F16\u8F91\u548C\u4FEE\u6539\u63A5\u53E3",width:"1050px",minHeight:480,title:e.getTitle,onOk:e.handleSubmit}),{default:u(()=>[l(L,{ref:"formRef",model:e.formData,"auto-label-width":""},{default:u(()=>[l(I,{gutter:16},{default:u(()=>[l(r,{span:12},{default:u(()=>[l(i,{field:"title",label:"\u63A5\u53E3\u540D\u79F0","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u63A5\u53E3\u540D\u79F0"}]},{default:u(()=>[l(_,{modelValue:e.formData.title,"onUpdate:modelValue":a[0]||(a[0]=o=>e.formData.title=o),placeholder:"\u8BF7\u586B\u63A5\u53E3\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{span:12},{default:u(()=>[l(i,{field:"url",label:"\u63A5\u53E3\u8DEF\u5F84",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u63A5\u63A5\u53E3\u8DEF\u5F84"}]},{default:u(()=>[e.formData.url||e.formData.apicode_type==2?(n(),g(_,{key:0,modelValue:e.formData.url,"onUpdate:modelValue":a[1]||(a[1]=o=>e.formData.url=o),placeholder:"\u8BF7\u586B\u63A5\u53E3\u8DEF\u5F84",disabled:e.formData.apicode_type==2,"allow-clear":""},null,8,["modelValue","disabled"])):(n(),g(v,{key:1,placeholder:"\u8BF7\u586B\u63A5\u53E3\u8DEF\u5F84","allow-search":"","allow-clear":"",onChange:e.hanldeUrl},{default:u(()=>[(n(!0),C(T,null,G(e.routerlist,o=>(n(),g(t,{value:o},{default:u(()=>[d(h(o),1)]),_:2},1032,["value"]))),256))]),_:1},8,["onChange"]))]),_:1})]),_:1}),l(r,{span:12},{default:u(()=>[l(i,{field:"dept_id",label:"\u9009\u62E9\u5206\u7EC4",style:{"margin-bottom":"15px"}},{default:u(()=>[l(R,{placeholder:"\u9009\u62E9\u5206\u7EC4",data:e.groupList,fieldNames:{key:"id",title:"name",children:"children"},modelValue:e.formData.cid,"onUpdate:modelValue":a[2]||(a[2]=o=>e.formData.cid=o)},null,8,["data","modelValue"])]),_:1})]),_:1}),l(r,{span:12},{default:u(()=>[F("div",Ve,[F("div",Ce,[l(i,{field:"status",label:"\u72B6\u6001","label-col-style":{flex:" 0 0 57px"},style:{"margin-bottom":"15px"}},{default:u(()=>[l(b,{modelValue:e.formData.status,"onUpdate:modelValue":a[3]||(a[3]=o=>e.formData.status=o)},{default:u(()=>[l(m,{value:0,style:{"margin-right":"2px"}},{default:u(()=>[...a[12]||(a[12]=[d("\u542F\u7528",-1)])]),_:1}),l(m,{value:1,style:{"margin-right":"2px"}},{default:u(()=>[...a[13]||(a[13]=[d("\u7981\u7528",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),F("div",he,[l(i,{field:"istoken",label:"Token","label-col-style":{flex:" 0 0 57px"},style:{"margin-bottom":"15px"}},{default:u(()=>[l(b,{modelValue:e.formData.istoken,"onUpdate:modelValue":a[4]||(a[4]=o=>e.formData.istoken=o)},{default:u(()=>[l(m,{value:0,style:{"margin-right":"2px"}},{default:u(()=>[...a[14]||(a[14]=[d("\u4E0D\u9700",-1)])]),_:1}),l(m,{value:1,style:{"margin-right":"2px"}},{default:u(()=>[...a[15]||(a[15]=[d("\u9700\u8981",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),_:1}),l(r,{span:12},{default:u(()=>[l(i,{field:"tablename",label:"\u6570\u636E\u8868\u540D",style:{"margin-bottom":"15px"}},{default:u(()=>[l(v,{modelValue:e.formData.tablename,"onUpdate:modelValue":a[5]||(a[5]=o=>e.formData.tablename=o),placeholder:"\u8BF7\u586B\u6570\u636E\u8868\u540D(\u9009\u586B)","allow-search":"","allow-clear":""},{label:u(({data:o})=>[F("span",null,h(o?.value),1)]),default:u(()=>[(n(!0),C(T,null,G(e.tablelist,o=>(n(),g(t,{value:o.name},{default:u(()=>[d(h(o.name+" "+o.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(r,{span:12},{default:u(()=>[l(i,{field:"method",label:"\u8BF7\u6C42\u65B9\u5F0F",style:{"margin-bottom":"15px"}},{default:u(()=>[l(b,{modelValue:e.formData.method,"onUpdate:modelValue":a[6]||(a[6]=o=>e.formData.method=o),onChange:e.handelMethodType},{default:u(()=>[l(m,{value:"get"},{default:u(()=>[...a[16]||(a[16]=[d("get",-1)])]),_:1}),l(m,{value:"post"},{default:u(()=>[...a[17]||(a[17]=[d("post",-1)])]),_:1}),l(m,{value:"put"},{default:u(()=>[...a[18]||(a[18]=[d("put",-1)])]),_:1}),l(m,{value:"delete"},{default:u(()=>[...a[19]||(a[19]=[d("delete",-1)])]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1}),l(r,{span:12},{default:u(()=>[l(i,{field:"param",label:"\u53C2\u6570",style:{"margin-bottom":"15px"}},{default:u(()=>[l(w,{modelValue:e.formData.param,"onUpdate:modelValue":a[7]||(a[7]=o=>e.formData.param=o),placeholder:"\u8BF7\u586B\u53C2\u6570(\u9009\u586B)","auto-size":{minRows:5,maxRows:6}},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{span:12},{default:u(()=>[l(i,{field:"remark",label:"\u5907\u6CE8",style:{"margin-bottom":"15px"}},{default:u(()=>[l(w,{modelValue:e.formData.des,"onUpdate:modelValue":a[8]||(a[8]=o=>e.formData.des=o),placeholder:"\u8BF7\u586B\u5907\u6CE8","auto-size":{minRows:5,maxRows:6}},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{span:14},{default:u(()=>[l(i,{field:"apicode_type",label:"\u63A5\u53E3\u4EE3\u7801\u7C7B\u578B",style:{"margin-bottom":"5px"}},{default:u(()=>[l(b,{modelValue:e.formData.apicode_type,"onUpdate:modelValue":a[9]||(a[9]=o=>e.formData.apicode_type=o),onChange:e.handelApicodeType},{default:u(()=>[l(m,{value:0},{default:u(()=>[...a[20]||(a[20]=[d("\u624B\u5199\u4EE3\u7801",-1)])]),_:1}),l(m,{value:1},{default:u(()=>[...a[21]||(a[21]=[d("\u81EA\u52A8\u751F\u6210",-1)])]),_:1}),l(m,{value:2},{default:u(()=>[...a[22]||(a[22]=[d("\u901A\u7528\u6570\u636E\u63A5\u53E3",-1)])]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1}),e.formData.apicode_type==1||e.formData.apicode_type==2?(n(),C(T,{key:0},[e.formData.method=="get"?(n(),g(r,{key:0,span:10},{default:u(()=>[l(i,{field:"getdata_type",label:"\u83B7\u53D6\u6570\u636E\u7C7B\u578B",style:{"margin-bottom":"5px"}},{default:u(()=>[l(b,{modelValue:e.formData.getdata_type,"onUpdate:modelValue":a[10]||(a[10]=o=>e.formData.getdata_type=o),onChange:e.handelGetdataType},{default:u(()=>[l(m,{value:"list"},{default:u(()=>[...a[23]||(a[23]=[d("\u6570\u636E\u5217\u8868",-1)])]),_:1}),l(m,{value:"data"},{default:u(()=>[...a[24]||(a[24]=[d("\u5355\u6761\u6570\u636E",-1)])]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1})):E("",!0),e.formData.apicode_type==1?(n(),g(r,{key:1,span:12},{default:u(()=>[l(i,{label:"",style:{"margin-bottom":"15px"}},{default:u(()=>[F("div",{class:ae(["btnrow",{uphandel:e.formData.id==0}])},[l(V,{onClick:e.handleInstall,"html-type":"submit",size:"large",type:"primary",shape:"round",style:{width:"150px"}},{default:u(()=>[d(h(e.formData.is_install!=0?"\u91CD\u65B0\u751F\u6210":"\u5F00\u59CB\u751F\u6210"),1)]),_:1},8,["onClick"]),e.formData.is_install==1?(n(),g(V,{key:0,onClick:e.handleUninstall,size:"large",shape:"round",style:{width:"150px"}},{default:u(()=>[...a[25]||(a[25]=[d("\u5378\u8F7D\u4EE3\u7801",-1)])]),_:1},8,["onClick"])):E("",!0),e.formData.is_install==2?(n(),g(V,{key:1,onClick:e.handleRemoveFile,size:"large",shape:"round",style:{width:"150px"}},{default:u(()=>[...a[26]||(a[26]=[d("\u5220\u9664\u6587\u4EF6",-1)])]),_:1},8,["onClick"])):E("",!0),e.formData.id==0?(n(),C("div",ke,[...a[27]||(a[27]=[F("div",{class:"text"},"\u8BF7\u5148\u4FDD\u5B58\u6570\u636E\u540E\u518D\u751F\u6210\u4EE3\u7801",-1)])])):E("",!0)],2)]),_:1})]),_:1})):E("",!0),e.formData.method=="get"?(n(),g(r,{key:2,span:12},{default:u(()=>[l(i,{field:"fields",label:"\u67E5\u8BE2\u5217\u8868\u5B57\u6BB5"},{default:u(()=>[l(v,{modelValue:e.formData.fields,"onUpdate:modelValue":a[11]||(a[11]=o=>e.formData.fields=o),onPopupVisibleChange:e.handelSelectFields,placeholder:"\u9009\u62E9\u67E5\u8BE2\u5217\u8868\u5B57\u6BB5",multiple:"","max-tag-count":12,"allow-clear":""},{default:u(()=>[(n(!0),C(T,null,G(e.fieldList,o=>(n(),g(t,{value:o.value},{default:u(()=>[d(h(o.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue","onPopupVisibleChange"])]),_:1})]),_:1})):E("",!0),e.formData.apicode_type==1&&e.formData.method=="get"&&e.formData.id!=0?(n(),g(r,{key:3,span:12},{default:u(()=>[F("div",Ae,[l(c,{class:"iconsd"}),a[28]||(a[28]=d("\u5982\u679C\u6709\u4FEE\u6539\u5185\u5BB9\u8BF7\u5148\u4FDD\u5B58\u5728\u751F\u6210\u4EE3\u7801 \u5426\u5219\u53C2\u6570\u4E0D\u662F\u6700\u65B0\u7684",-1))])]),_:1})):E("",!0),e.formData.apicode_type==2?(n(),g(r,{key:4,span:24},{default:u(()=>[F("div",we,[l(c),a[29]||(a[29]=d("\u201C\u901A\u7528\u6570\u636E\u63A5\u53E3\u201D\u65E0\u9700\u7F16\u5199\u4EE3\u7801 \u76F4\u63A5\u8C03\u7528\u901A\u7528api\u63A5\u53E3\u5373\u53EF\u5B8C\u6210\u589E\u5220\u67E5\u6539\uFF08\u4F20api_id\u533A\u5206\uFF09",-1))])]),_:1})):E("",!0)],64)):E("",!0)]),_:1})]),_:1},8,["model"])]),_:1},16,["onRegister","loading","title","onOk"])}const qe=Z(_e,[["render",Ue],["__scopeId","data-v-8f584086"]]);export{qe as default};
